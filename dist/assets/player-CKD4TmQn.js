import{L as r,M as h}from"./api-RBkkRLth.js";import{Z as u,_ as d,d as p,o as y,am as g}from"./index-Xoaj6-Zc.js";const a={volume:"PLAYER-VOLUME"},l=u({id:"player",state:()=>{var s;return{audio:new Audio,loopType:0,volume:((s=localStorage.getItem(a.volume))==null?void 0:s.toInt())||60,playList:[],showPlayList:!1,id:0,url:"",songUrl:{},song:{},isPlaying:!1,isPause:!0,sliderInput:!1,ended:!1,muted:!1,currentTime:0,duration:0}},getters:{playListCount:s=>s.playList.length,thisIndex:s=>s.playList.findIndex(t=>t.id===s.id),nextSong(s){const{thisIndex:t,playListCount:i}=this;if(this.thisIndex===i-1)return s.playList.first();{const e=t+1;return s.playList[e]}},prevSong(s){const{thisIndex:t}=this;if(this.thisIndex===0)return s.playList.last();{const i=t-1;return s.playList[i]}}},actions:{init(){this.audio.volume=this.volume/100},pushPlayList(s,...t){if(s){this.playList=t;return}t.forEach(i=>{this.playList.filter(e=>e.id===i.id).length<=0&&this.playList.push(i)})},clearPlayList(){this.songUrl={},this.url="",this.id=0,this.song={},this.isPause=!1,this.isPlaying=!1,this.sliderInput=!1,this.ended=!1,this.muted=!1,this.currentTime=0,this.playList=[],this.showPlayList=!1,this.audio.load(),setTimeout(()=>{this.duration=0},500)},async play(s){if(s===this.id)return;this.isPlaying=!1;const t=await r(s);this.audio.src=t.url,this.audio.play().then(i=>{this.isPlaying=!0,this.isPause=!1,this.songUrl=t,this.url=t.url,this.id=s,this.songDetail()}).catch(i=>{console.log(i)})},playEnd(){switch(console.log("播放结束"),this.loopType){case 0:this.rePlay();break;case 1:this.next();break;case 2:this.randomPlay();break}},async songDetail(){this.song=await h(this.id),this.pushPlayList(!1,this.song)},rePlay(){setTimeout(()=>{this.currentTime=0,this.audio.play()},1500)},randomPlay(){this.play(this.playList.sample().id)},next(){this.loopType===2?this.randomPlay():this.play(this.nextSong.id)},prev(){this.play(this.prevSong.id)},togglePlay(){this.song.id&&(this.isPlaying?(this.audio.pause(),this.isPause=!0):(this.audio.play(),this.isPause=!1),this.isPlaying=!this.isPlaying)},toggleLoop(){this.loopType=++this.loopType%3},toggleMuted(){this.muted=!this.muted,this.audio.muted=this.muted},setVolume(s){s=s>100?100:s,s=s<0?0:s,this.volume=s,this.audio.volume=s/100,localStorage.setItem(a.volume,s.toString())},onSliderChange(s){this.currentTime=s,this.sliderInput=!1,this.audio.currentTime=s},onSliderInput(s){this.sliderInput=!0},setPlay(){this.song.id&&(this.isPlaying=!0,this.audio.play(),this.isPause=!1)},setPause(){this.song.id&&(this.isPlaying=!1,this.audio.pause(),this.isPause=!0)},interval(){this.isPlaying&&!this.sliderInput&&(this.currentTime=parseInt(this.audio.currentTime.toString()),this.duration=parseInt(this.audio.duration.toString()),this.ended=this.audio.ended)}}}),c=()=>{let s;const{init:t,playEnd:i,interval:e}=l(),{ended:o}=d(l());p(o,n=>{n&&i()}),y(()=>{t(),console.log("启动定时器"),s=setInterval(e,1e3)}),g(()=>{console.log("清除定时器"),clearInterval(Number(s))})};export{c as a,l as u};
